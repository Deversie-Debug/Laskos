<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Virtual Statue Phone Call Demo</title>
<style>
  html, body { margin:0; padding:0; height:100%; width:100%; font-family:Arial,sans-serif; background:#e6f0ff; display:flex; justify-content:center; align-items:center; }
  .screen { width:100vw; height:100vh; display:none; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px; }
  .active { display:flex; }
  .flags-container { display:flex; gap:20px; margin-top:30px; }
  .flag { width:60px; height:40px; cursor:pointer; border-radius:5px; border:2px solid transparent; }
  .flag:hover { transform: scale(1.1); border:2px solid #0077cc; }
  .statue-container { position:relative; width:180px; height:180px; display:flex; justify-content:center; align-items:center; margin:20px 0; }
  .statue-img { width:150px; height:150px; border-radius:50%; border:3px solid #0077cc; z-index:3; }
  
  /* Softer, smaller, more visible ripples */
  .ripple-ring {
    position: absolute;
    width:100px;
    height:100px;
    border-radius:50%;
    border:2px solid #0077cc;
    opacity:0.35;
    pointer-events:none;
    z-index:1;
    transform: scale(1);
    transition: transform 0.25s ease-out, opacity 0.25s ease-out;
  }
  .ripple-ring:nth-child(2) { border-color:#3399ff; }
  .ripple-ring:nth-child(3) { border-color:#66ccff; }

  button { padding:15px 25px; border-radius:50px; border:none; color:white; font-weight:bold; font-size:18px; cursor:pointer; margin:10px; min-width:120px; }
  .answer { background-color:#28a745; animation:pulse 1.2s infinite; }
  .decline { background-color:#dc3545; }
  .end-call { background-color:#ff9933; min-width:180px; }
  @keyframes pulse { 0%{transform:scale(1);} 50%{transform:scale(1.1);} 100%{transform:scale(1);} }
  @keyframes bounce { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }
  @keyframes talk { 0%{transform:scale(1);} 50%{transform:scale(1.03);} 100%{transform:scale(1);} }
  .incoming-call .statue-img { animation: bounce 1s infinite; box-shadow:0 0 15px #0077cc; }
  .talking { animation: talk 0.6s infinite alternate; }
</style>
</head>
<body>

<!-- Language Selection -->
<div class="screen active" id="languageScreen">
  <h1>Select Language</h1>
  <div class="flags-container">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/2d/Animated-Flag-United-Kingdom.gif" class="flag" data-lang="en" alt="English">
    <img src="https://upload.wikimedia.org/wikipedia/commons/e/eb/Animated-Flag-Greece.gif" class="flag" data-lang="gr" alt="Greek">
  </div>
</div>

<!-- Incoming Call -->
<div class="screen" id="incomingCall">
  <h1>Incoming Call</h1>
  <p id="callName">Vasilis Laskos</p>
  <div class="statue-container incoming-call">
    <img src="https://raw.githubusercontent.com/Deversie-Debug/Laskos/main/LaskosGR.jpg" alt="Statue" class="statue-img" id="incomingStatue">
  </div>
  <div>
    <button class="answer" id="answerBtn">Answer</button>
    <button class="decline" id="declineBtn">Decline</button>
  </div>
</div>

<!-- Active Call -->
<div class="screen" id="activeCall">
  <h1>Call with Statue</h1>
  <div class="statue-container" id="activeStatueContainer">
    <div class="ripple-ring" id="ring1"></div>
    <div class="ripple-ring" id="ring2"></div>
    <div class="ripple-ring" id="ring3"></div>
    <img src="https://raw.githubusercontent.com/Deversie-Debug/Laskos/main/LaskosGR.jpg" alt="Statue" class="statue-img" id="activeStatue">
  </div>
  <button class="end-call" id="endCallBtn">End Call</button>
</div>

<audio id="audio"></audio>

<script>
const languageScreen = document.getElementById('languageScreen');
const incomingCall = document.getElementById('incomingCall');
const activeCall = document.getElementById('activeCall');
const answerBtn = document.getElementById('answerBtn');
const declineBtn = document.getElementById('declineBtn');
const endCallBtn = document.getElementById('endCallBtn');
const audio = document.getElementById('audio');
const activeStatue = document.getElementById('activeStatue');

const ring1 = document.getElementById('ring1');
const ring2 = document.getElementById('ring2');
const ring3 = document.getElementById('ring3');

const flags = document.querySelectorAll('.flag');
let selectedLanguage = 'gr';

// Hosted audio from GitHub Pages
let statueVoices = {
  en: 'https://deversie-debug.github.io/Laskos/LaskosEN.mp3',
  gr: 'https://deversie-debug.github.io/Laskos/LaskosGR.mp3'
};

// Translations
const translations = {
  en: {
    selectLanguage: "Select Language",
    incomingCall: "Incoming Call",
    callWithStatue: "Call with Statue",
    answer: "Answer",
    decline: "Decline",
    endCall: "End Call",
    callDeclined: "Call Declined",
    callEnded: "Call Ended",
    statueName: "Vasilis Laskos"
  },
  gr: {
    selectLanguage: "Επιλέξτε Γλώσσα",
    incomingCall: "Εισερχόμενη Κλήση",
    callWithStatue: "Κλήση με το Άγαλμα",
    answer: "Απάντηση",
    decline: "Απόρριψη",
    endCall: "Τερματισμός Κλήσης",
    callDeclined: "Κλήση Απορρίφθηκε",
    callEnded: "Κλήση Τερματίστηκε",
    statueName: "Βασίλης Λάσκος"
  }
};

// Language selection
flags.forEach(flag => {
  flag.addEventListener('click', () => {
    selectedLanguage = flag.dataset.lang;
    audio.src = statueVoices[selectedLanguage];

    document.querySelector('#languageScreen h1').textContent = translations[selectedLanguage].selectLanguage;
    document.querySelector('#callName').textContent = translations[selectedLanguage].statueName;
    document.querySelector('#incomingCall h1').textContent = translations[selectedLanguage].incomingCall;
    document.querySelector('#activeCall h1').textContent = translations[selectedLanguage].callWithStatue;
    answerBtn.textContent = translations[selectedLanguage].answer;
    declineBtn.textContent = translations[selectedLanguage].decline;
    endCallBtn.textContent = translations[selectedLanguage].endCall;

    languageScreen.classList.remove('active');
    incomingCall.classList.add('active');
  });
});

let audioContext, analyser, source, dataArray;

function setupAudioVisualizer() {
  audioContext = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioContext.createAnalyser();
  source = audioContext.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(audioContext.destination);
  analyser.fftSize = 256;
  const bufferLength = analyser.frequencyBinCount;
  dataArray = new Uint8Array(bufferLength);

  function animateRipples() {
    analyser.getByteFrequencyData(dataArray);
    let sum = dataArray.reduce((a,b)=>a+b,0);
    let avg = sum / dataArray.length;

    let scaleBase = 1 + avg/300;
    let opacity = Math.min(0.6, avg/500); // more visible

    ring1.style.transform = `scale(${scaleBase})`;
    ring1.style.opacity = opacity;

    ring2.style.transform = `scale(${scaleBase * 1.2})`;
    ring2.style.opacity = opacity * 0.6;

    ring3.style.transform = `scale(${scaleBase * 1.4})`;
    ring3.style.opacity = opacity * 0.3;

    if (!audio.paused) requestAnimationFrame(animateRipples);
    else { ring1.style.opacity=0; ring2.style.opacity=0; ring3.style.opacity=0; }
  }

  animateRipples();
}

// Answer Call
answerBtn.addEventListener('click', async () => {
  if(audioContext && audioContext.state==='suspended') await audioContext.resume();

  incomingCall.classList.remove('active');
  activeCall.classList.add('active');
  audio.currentTime = 0;
  audio.play();
  activeStatue.classList.add('talking');

  if(!audioContext) setupAudioVisualizer();
});

// Decline Call
declineBtn.addEventListener('click', () => {
  alert(translations[selectedLanguage].callDeclined);
});

// End Call
endCallBtn.addEventListener('click', () => {
  audio.pause();
  activeCall.classList.remove('active');
  incomingCall.classList.add('active');
  activeStatue.classList.remove('talking');
  ring1.style.opacity=0; ring2.style.opacity=0; ring3.style.opacity=0;

  alert(translations[selectedLanguage].callEnded);
});

// Stop talking animation when audio ends
audio.addEventListener('ended', ()=>{
  activeStatue.classList.remove('talking');
  ring1.style.opacity=0; ring2.style.opacity=0; ring3.style.opacity=0;
});

// Resume AudioContext on any click
document.body.addEventListener('click', ()=>{
  if(audioContext && audioContext.state==='suspended') audioContext.resume();
});
</script>
</body>
</html>
